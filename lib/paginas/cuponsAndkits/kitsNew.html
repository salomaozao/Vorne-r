<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- TODO(gab): antes de enviar o form, checar se há produtos. -->
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>

		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
			crossorigin="anonymous"
		/>

		<style>
			.card-horizontal {
				display: flex;
				flex: 1 1 auto;
			}

			.img-square-wrapper img {
				height: 7em;
				width: 7em;
				object-fit: cover;
			}
		</style>
	</head>
	<body>
		<div id="cuponsAndKits" class="container text-center pt-4">
			<div>
				<h2 class="title">Criação de códigos de desconto</h2>
			</div>
			<form action="" method="post">
				<div class="row mx-auto w-50">
					<div id="inputsArea" class="col-6 p-0 container">
						<div class="text-left my-2 row">
							<label class="col-12" for="prod_name"
								>Nome do cupom</label
							>
							<input
								required
								class="col-12 bg-secondary border-0 px-2 py-1"
								type="text"
								name="prod_name"
								id="prod_name"
							/>
						</div>
						<div class="text-left my-2 row">
							<label class="col-12" for="prod_val">Valor</label>
							<div class="col-12">
								<div class="row p-0">
									<input
										required
										class="
											col-9
											border-0
											bg-secondary
											py-1
											pl-2
										"
										type="number"
										id="prod_val"
										name="prod_val"
									/>
									<select
										class="col-3 border-0 bg-secondary py-1"
										type="text"
										id="cup_type"
									>
										<option>%</option>
										<option>R$</option>
									</select>
								</div>
							</div>
						</div>
					</div>

					<div
						id="checkboxArea"
						class="col-4 p-0 d-flex align-items-center"
					>
						<div class="flex-column">
							<div class="d-flex justify-content-start">
								<input
									type="radio"
									name="cup_type"
									id="type_selected"
									onclick="promoCode.prodSelect.show()"
									checked
								/>
								<label class="ml-1 mt-1" for="cup_type"
									>Selecionados</label
								>
							</div>
							<div class="d-flex justify-content-start">
								<input
									type="radio"
									name="cup_type"
									id="type_all"
									onclick="promoCode.prodSelect.hide()"
								/>
								<label class="ml-1 mt-1" for="cup_type"
									>Todos</label
								>
							</div>
						</div>
					</div>
				</div>
				<div id="prod-select">
					<div id="prod_show" class="container">
						<div
							id="prod_select"
							class="
								row
								p-2
								py-3
								my-2
								w-50
								mx-auto
								border
								rounded
								shadow-sm
							"
						>
							<h4 class="title col-12">Selecionar produtos</h4>
							<input
								type="text"
								id="prodId_input"
								placeholder="ID do produto"
								class="col"
								required
							/>
							<div class="col px-0">
								<button
									class="btn btn-light border"
									onclick="promoCode.prodAdd()"
								>
									OK!
								</button>
								<button
									class="btn btn-light border"
									onclick="promoCode.prodSelect.hide()"
								>
									Cancelar
								</button>
							</div>
						</div>
						<div
							id="products_added"
							class="
								products_show
								bg-secondary
								shadow-lg
								border
								rounded
								w-50
								mx-auto
							"
						></div>
					</div>
					<button
						class="btn btn-lg btn-success my-2 shadow"
						type="submit"
					>
						Criar Cupom!
					</button>
					<div id="cup-managing" class="my-4">
						<h4 class="text-left">Cupons existentes</h4>
						<table class="table">
							<thead>
								<tr>
									<th scope="col">#</th>
									<th scope="col">Nome</th>
									<th scope="col">Preço</th>
									<th scope="col">Disponível</th>
									<th scope="col">Apagar</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th scope="row">1</th>
									<td>MEUCUÉSEU</td>
									<td>R$19,99</td>
									<td><input type="checkbox" /></td>
									<td>
										<button class="btn btn-danger">
											Apagar
										</button>
									</td>
								</tr>
								<tr>
									<th scope="row">2</th>
									<td>{prod_name}</td>
									<td>R${prod_preço}</td>
									<td>
										<input
											type="checkbox"
											checked="{prod_disponível}"
										/>
									</td>
									<td>
										<button class="btn btn-danger">
											Apagar
										</button>
									</td>
								</tr>
								<tr>
									<th scope="row">3</th>
									<td>PROMO50</td>
									<td>R$19,99</td>
									<td><input type="checkbox" /></td>
									<td>
										<button class="btn btn-danger">
											Apagar
										</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</form>
		</div>

		<script>
			const toggleView = () => {
				if (
					document.getElementById("cuponsArea").style.display ===
					"none"
				) {
					document.getElementById("title").innerHTML =
						"Criação de códigos de desconto"
					document.getElementById("cuponsArea").style.display = "flex"
					document.getElementById("kitsArea").style.display = "none"
				} else {
					document.getElementById("title").innerHTML =
						"Criação de kits"
					document.getElementById("cuponsArea").style.display = "none"
					document.getElementById("kitsArea").style.display = "flex"
				}
			}

			const getProduct = (id) => {
				return {
					name: "Loló",
					price: "199,00",
					imgRef: "https://i.pinimg.com/564x/ed/ce/10/edce1084dfe053817cc6636483b95a17.jpg",
				}
			}

			function showData(div, arr, page) {
				function productComponent(name, price, imgRef, count) {
					// return `<div " class="row product"><img  /><span>, </span> <a class="material-icons" onclick="" href="#">remove</a></div>`
					return `
			                 <div class="container-fluid"  id="prod-${count}">
			                     <div class="row">
			                         <div class="col-12 my-3">
			                             <div class="card">
			                                 <div class="card-horizontal">
			                                     <div class="img-square-wrapper">
			                                         <img class="m-1 rounded" src="${imgRef}" alt="Card image cap" />
			                                     </div>
			                                     <div
			                                         class="
			                                             card-body
			                                             d-flex
			                                             flex-row
			                                             justify-content-between
			                                         "
			                                     >
			                                         <div>
			                                             <h2 class="card-title">${name}</h2>
			                                             <p class="card-text text-muted">R$${price}</p>
			                                         </div>

			                                         <div>
			                                             <a
			                                                 href="#"
			                                                 class="text-danger mt-2"
			                                                 onclick="${page}.prodRemove(${count})"
			                                                 >remover</a
			                                             >
			                                         </div>
			                                     </div>
			                                 </div>
			                             </div>
			                         </div>
			                     </div>
			                 </div>

			                 `
				}
				document.getElementById(div).innerHTML = ""

				arr.forEach((el) => {
					const data = getProduct(el.id)
					document.getElementById(div).innerHTML += productComponent(
						data.name,
						data.price,
						data.imgRef,
						el.count,
					)
				})
			}

			const kits = {
				selectedProducts: [],
				count: 0,

				prodRemove: (i) => {
					document
						.getElementById("kitsArea")
						.querySelector(`#prod-${i}`)
						.remove()
					kits.selectedProducts.pop(i)
				},

				addProduct: () => {
					const data = document
						.getElementById("kit_data")
						.querySelectorAll("input")

					kits.selectedProducts.push({
						id: data[0].value,
						count: kits.count++,
					})
					showData("kit-selectedProds", kits.selectedProducts, "kits")
				},
			}

			const promoCode = {
				prodSelect: {
					show: () => {
						document.getElementById("prod_show").style.display =
							"block"
					},

					hide: () => {
						document.getElementById("prod_show").style.display =
							"none"
					},
				},
				addBttn: {
					disable: () => {
						document.getElementById(
							"cup_productAdd",
						).disabled = true
						document.getElementById("prod_show").style.display =
							"none"
					},
					enable: () => {
						document.getElementById(
							"cup_productAdd",
						).disabled = false
						document.getElementById("prod_show").style.display =
							"flex"
					},
				},
				productComponentArr: [],
				count: 0,

				prodRemove: (i) => {
					document.querySelector(`#prod-${i}`).remove()
					promoCode.productComponentArr.pop(i)
				},
				prodAdd: () => {
					// promoCode.prodSelect.hide()
					promoCode.count++
					function getData() {
						const prodData = [
							document.getElementById("prod_name"),
							document.getElementById("prod_val"),
						]

						return {
							id: prodData[0].value,
							count: promoCode.count - 1,
						}
					}

					promoCode.productComponentArr.push(getData())
					showData(
						"products_added",
						promoCode.productComponentArr,
						"promoCode",
					)
				},
			}
		</script>
	</body>
</html>
